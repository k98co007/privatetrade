# Software Requirements Specification (SRS) - v2.0
**버전**: 2.0  
**기반**: TICKET-007 (유저스토리 2.0)  
**작성일**: 2026년 2월 8일  
**변경 사항**: US-007(특정 종목 선택) 기반으로 FR-106~109 추가  

---

## 1. 개요

이 문서는 주식투자 전략 백테스팅 시스템(Stock Trading Strategy Backtesting Simulator)의 상세 기능 요구사항을 정의한다.

### 1.1 시스템 개요
- **목적**: 사용자의 단기 주식 투자 전략을 코스피 200 종목을 대상으로 백테스팅하는 웹 애플리케이션
- **대상 사용자**: 주식투자자 (시스템: B2C)
- **플랫폼**: 웹 애플리케이션 (프론트엔드: HTML/CSS/JavaScript, 백엔드: Python/Node.js)
- **배포**: 로컬 서버 (localhost)
- **버전**: 2.0 (특정 종목 선택 기능 추가)

### 1.2 주요 특징
- 웹브라우저 기반 UI
- 실시간 진행상황 모니터링
- 상세한 거래 내역 및 차트 시각화
- **[NEW]** 특정 종목 선택 및 백테스팅 (다중 모드 지원)
- 비용 포함 시뮬레이션 (세금 0.2%, 수수료 0.011%)

### 1.3 백테스팅 종목 선택 모드 (3가지)
1. **기본 모드**: 코스피 200 전체 종목
2. **필터 모드**: 블랙리스트/화이트리스트 적용 후 필터링된 종목
3. **[NEW]** **특정 종목 모드**: 사용자가 직접 선택한 특정 종목들만 대상

---

## 2. 기능 요구사항

### 2.1 종목 관리 (FR-101~FR-109)

#### FR-101: 블랙리스트 조회
- **설명**: 현재 백테스팅에서 제외할 블랙리스트 종목 목록 조회
- **기능**:
  - 블랙리스트 팝업 또는 사이드판 오픈 시 현재 목록 즉시 표시
  - 종목명 또는 종목코드로 검색 지원
  - 페이지네이션: 최대 50개씩 표시
- **데이터 입력 형식**: 코드(6자리 숫자) 또는 종목명(한글/영문)
- **데이터 출력 형식**: JSON 배열
  ```json
  { "code": "005930", "name": "삼성전자" }
  ```

#### FR-102: 블랙리스트 추가
- **설명**: 특정 종목을 블랙리스트에 추가
- **기능**:
  - 종목 검색 (자동완성: 최소 2글자 입력 시 매칭 종목 제시)
  - 선택된 종목을 리스트에 추가
  - 중복 체크: 이미 추가된 종목 재추가 방지
- **API 엔드포인트**: `POST /api/blacklist/add`
- **요청 본문**: `{ "code": "005930" }`
- **응답**: `{ "success": true, "message": "블랙리스트 추가됨", "blacklist_count": 15 }`

#### FR-103: 블랙리스트 제거
- **설명**: 특정 종목을 블랙리스트에서 제거
- **기능**:
  - 목록에서 제거 버튼 클릭
  - 확인 팝업 (실수 방지)
- **API 엔드포인트**: `DELETE /api/blacklist/{code}`
- **응답**: `{ "success": true, "blacklist_count": 14 }`

#### FR-104: 화이트리스트 추가
- **설명**: 코스피 200 외 추가 종목을 백테스팅 대상에 포함
- **기능**:
  - 종목 검색 입력창 (자동완성)
  - 화이트리스트에 추가되지 않은 종목만 선택 가능
  - 최대 개수 제한: 100개
- **API 엔드포인트**: `POST /api/whitelist/add`
- **요청 본문**: `{ "code": "066570" }`

#### FR-105: 화이트리스트 제거
- **설명**: 화이트리스트 종목 제거
- **기능**:
  - 목록에서 제거 버튼 클릭
- **API 엔드포인트**: `DELETE /api/whitelist/{code}`

---

#### FR-106: 특정 종목 선택 모드 활성화 (NEW)
- **설명**: 사용자가 특정 종목만 선택하여 백테스팅할 수 있도록 모드 전환
- **기능**:
  - 웹브라우저 UI에서 라디오 버튼 또는 탭 제공: "전체 종목 | 필터 기반 | **특정 종목만**"
  - "특정 종목만" 선택 시 종목 추가/제거 섹션 표시
  - 기존 블랙/화이트리스트와의 상호 배제 (한 번에 하나만 선택)
- **UI 상태 전이**:
  ```
  [전체 종목] (라디오 선택) → 코스피 200 전체 사용
  [필터 기반] (라디오 선택) → 블랙/화이트리스트 UI 표시
  [특정 종목만] (라디오 선택) → 특정 종목 추가/제거 UI 표시
  ```
- **API 엔드포인트**: `POST /api/stocks/mode`
- **요청 본문**: `{ "mode": "specific" }`  # "all", "filtered", "specific" 중
- **응답**: `{ "success": true, "current_mode": "specific" }`

#### FR-107: 특정 종목 추가 (NEW)
- **설명**: 특정 종목 모드에서 백테스팅 대상 종목 추가
- **기능**:
  - 종목 검색 (자동완성): 2글자 이상 입력 시 매칭 종목 리스트 제시
  - 다중 선택 지원: Ctrl+클릭 또는 전체 선택/해제 버튼
  - 선택된 종목을 버짓에 추가
  - 중복 추가 방지
  - 최대 100개 제한
- **API 엔드포인트**: `POST /api/stocks/specific/add`
- **요청 본문**:
  ```json
  {
    "codes": ["005930", "000660", "SK000660"]
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "selected_count": 3,
    "selected_stocks": [
      { "code": "005930", "name": "삼성전자" },
      { "code": "000660", "name": "SK하이닉스" }
    ]
  }
  ```

#### FR-108: 특정 종목 조회 (NEW)
- **설명**: 현재 선택된 특정 종목 목록 조회
- **기능**:
  - 선택된 종목 리스트 UI에 표시
  - 선택 개수 표시 (예: "2개 선택: 삼성전자, SK하이닉스")
  - 페이지네이션 (최대 20개씩)
- **API 엔드포인트**: `GET /api/stocks/specific`
- **응답**:
  ```json
  {
    "current_mode": "specific",
    "selected_count": 2,
    "selected_stocks": [
      { "code": "005930", "name": "삼성전자" },
      { "code": "000660", "name": "SK하이닉스" }
    ]
  }
  ```

#### FR-109: 특정 종목 제거 (NEW)
- **설명**: 특정 종목 모드에서 선택된 종목 제거
- **기능**:
  - 목록에서 개별 제거 버튼
  - 전체 초기화 버튼 (한 번에 모두 제거)
  - 확인 팝업 (전체 초기화 시에만)
- **API 엔드포인트**: `DELETE /api/stocks/specific/{code}`
- **응답**: `{ "success": true, "selected_count": 1 }`

---

### 2.2 전략 설정 (FR-201~FR-204)

#### FR-201: 전략 선택
- **설명**: 백테스팅할 투자 전략 선택
- **전략 옵션**:
  1. **전략 1**: 고정시간 매수/매도 (Daily Trading)
  2. **전략 2**: Trailing Stop 전략
- **UI 구현**: 라디오 버튼 또는 탭 형식
- **선택 시 동작**: 선택된 전략에 맞는 파라미터 입력 섹션 표시

#### FR-202: 전략 1 파라미터 입력
- **기능**: 고정 매수/매도 시간 설정
- **파라미터**:
  - `buy_time`: 매수 시간 (HH:MM 형식)
  - `sell_time`: 매도 시간 (HH:MM 형식)
- **유효성 검사**:
  - buy_time < sell_time (당일 청산)
  - 09:00 <= buy_time <= 15:30
  - 09:00 <= sell_time <= 16:00
- **기본값**: buy_time=10:00, sell_time=15:00

#### FR-203: 전략 2 파라미터 입력
- **기능**: Trailing Stop 전략 파라미터 설정
- **파라미터**:
  - `buy_time`: 매수 시간 (기본: 15:30)
  - `min_profit_pct`: 최소 수익률 (기본: 1.0%)
  - `profit_cutoff_pct`: 이익보전 컷오프 (기본: 80.0%)
  - `loss_cutoff_time`: 손절 컷오프 시간 (다음날)

#### FR-204: 파라미터 저장
- **API 엔드포인트**: `POST /api/strategy/config`
- **요청 본문**: 전략별 파라미터 (기존 사양 유지)
- **응답**: `{ "success": true, "config_id": "cfg_001" }`

---

### 2.3 백테스팅 실행 및 모니터링 (FR-301~FR-310)

#### FR-301: 백테스팅 시작
- **설명**: 선택된 종목 모드 + 전략으로 백테스팅 시작
- **기능**:
  - "백테스팅 시작" 버튼 (비활성 조건: 전략 미선택 또는 특정 종목 모드에서 종목 미선택)
  - 클릭 시 backend 시작 신호 전송
  - 즉시 진행상황 모니터링 모드 전환
- **API 엔드포인트**: `POST /api/backtest/start`
- **요청 본문**: 기존 사양 + stock_mode 필드
  ```json
  {
    "config_id": "cfg_001",
    "stock_mode": "specific",
    "selected_stocks": ["005930", "000660"]
  }
  ```

#### FR-302: 실시간 진행상황 조회
- **설명**: 백테스팅 진행률 및 현재 처리 종목 조회
- **API 엔드포인트**: `GET /api/backtest/progress`
- **응답**: 기존 사양 (stock_mode, selected_stocks 포함 가능)
  ```json
  {
    "total": 2,
    "completed": 1,
    "current_stock": "삼성전자",
    "progress_pct": 50,
    "elapsed_sec": 120,
    "stock_mode": "specific"
  }
  ```

---

### 2.4 결과 조회 (FR-401~FR-405)

#### FR-401: 백테스팅 결과 조회
- **설명**: 백테스팅 완료 후 종합 결과 조회
- **API 엔드포인트**: `GET /api/backtest/result/{session_id}`
- **응답 포함 정보**:
  - 종목별 거래 내역 (수익/손해)
  - 총 수익률, 수익금, 손해금
  - 거래일, 거래 횟수
  - **[NEW]** stock_mode, selected_stocks (특정 종목 모드일 경우)

---

## 3. 비기능 요구사항 (NFR)

### 3.1 성능 (NFR-101~103)
- **특정 종목 모드 성능**: 100개 종목 백테스팅 완료 시간 < 10분
- **API 응답 시간**: < 500ms (대부분)
- **WebSocket 메시지 지연**: < 2초

### 3.2 보안 (NFR-201~202)
- **입력 유효성 검사**: 모든 종목 코드 형식(6자리 숫자) 검증
- **세션 관리**: 백테스팅 세션 ID 추적

### 3.3 확장성 (NFR-301)
- **종목 데이터 캐싱**: Yahoo Finance 데이터 일일 1회만 수집

---

## 4. 데이터 모델 (변경사항)

### 4.1 종목 모드 저장
- **테이블**: config 테이블에 `stock_mode` 필드 추가
  ```
  stock_mode: "all" | "filtered" | "specific"
  selected_specific_stocks: JSON 배열 (특정 종목 모드일 때만)
  ```

---

## 변경 이력

| 버전 | 작성자 | 작성일 | 변경 사항 |
|------|--------|--------|---------|
| 1.0 | SRS_담당자 | 2026-02-08 | FR-101~204, FR-301~305, FR-401~405 (기본 기능) |
| 2.0 | SRS_담당자 | 2026-02-08 | **FR-106~109 추가** (특정 종목 선택), **FR-301, 302, 401 갱신** (stock_mode 포함) |

---

## 다음 단계
- HLD 담당자: SRS 2.0 아키텍처 영향도 검토 (TICKET-008)

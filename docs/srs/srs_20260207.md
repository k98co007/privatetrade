# Software Requirements Specification (SRS)
**버전**: 1.0  
**기반**: TICKET-002 (유저스토리)  
**작성일**: 2026년 2월 8일  

---

## 1. 개요

이 문서는 주식투자 전략 백테스팅 시스템(Stock Trading Strategy Backtesting Simulator)의 상세 기능 요구사항을 정의한다.

### 1.1 시스템 개요
- **목적**: 사용자의 단기 주식 투자 전략을 코스피 200 종목을 대상으로 백테스팅하는 웹 애플리케이션
- **대상 사용자**: 주식투자자 (시스템: B2C)
- **플랫폼**: 웹 애플리케이션 (프론트엔드: HTML/CSS/JavaScript, 백엔드: Python/Node.js)
- **배포**: 로컬 서버 (localhost)

### 1.2 주요 특징
- 웹브라우저 기반 UI
- 실시간 진행상황 모니터링
- 상세한 거래 내역 및 차트 시각화
- 비용 포함 시뮬레이션 (세금 0.2%, 수수료 0.011%)

---

## 2. 기능 요구사항

### 2.1 종목 관리 (FR-101~FR-105)

#### FR-101: 블랙리스트 조회
- **설명**: 현재 백테스팅에서 제외할 블랙리스트 종목 목록 조회
- **기능**:
  - 블랙리스트 팝업 또는 사이드판 오픈 시 현재 목록 즉시 표시
  - 종목명 또는 종목코드로 검색 지원
  - 페이지네이션: 최대 50개씩 표시
- **데이터 입력 형식**: 코드(6자리 숫자) 또는 종목명(한글/영문)
- **데이터 출력 형식**: JSON 배열
  ```json
  { "code": "005930", "name": "삼성전자" }
  ```

#### FR-102: 블랙리스트 추가
- **설명**: 특정 종목을 블랙리스트에 추가
- **기능**:
  - 종목 검색 (자동완성: 최소 2글자 입력 시 매칭 종목 제시)
  - 선택된 종목을 리스트에 추가
  - 중복 체크: 이미 추가된 종목 재추가 방지
- **API 엔드포인트**: `POST /api/blacklist/add`
- **요청 본문**:
  ```json
  { "code": "005930" }
  ```
- **응답 예시**:
  ```json
  { "success": true, "message": "블랙리스트 추가됨", "blacklist_count": 15 }
  ```

#### FR-103: 블랙리스트 제거
- **설명**: 특정 종목을 블랙리스트에서 제거
- **기능**:
  - 목록에서 제거 버튼 클릭
  - 확인 팝업 (실수 방지)
- **API 엔드포인트**: `DELETE /api/blacklist/{code}`
- **응답 예시**:
  ```json
  { "success": true, "blacklist_count": 14 }
  ```

#### FR-104: 화이트리스트 추가
- **설명**: 코스피 200 외 추가 종목을 백테스팅 대상에 포함
- **기능**:
  - 종목 검색 입력창 (자동완성)
  - 화이트리스트에 추가되지 않은 종목만 선택 가능
  - 최대 개수 제한: 100개
- **API 엔드포인트**: `POST /api/whitelist/add`
- **요청 본문**:
  ```json
  { "code": "066570" }  // 삼성전자우 등
  ```

#### FR-105: 화이트리스트 제거
- **설명**: 화이트리스트 종목 제거
- **기능**:
  - 목록에서 제거 버튼 클릭
- **API 엔드포인트**: `DELETE /api/whitelist/{code}`

---

### 2.2 전략 설정 (FR-201~FR-204)

#### FR-201: 전략 선택
- **설명**: 백테스팅할 투자 전략 선택
- **전략 옵션**:
  1. **전략 1**: 고정시간 매수/매도 (Daily Trading)
  2. **전략 2**: Trailing Stop 전략
- **UI 구현**: 라디오 버튼 또는 탭 형식
- **선택 시 동작**: 선택된 전략에 맞는 파라미터 입력 섹션 표시

#### FR-202: 전략 1 파라미터 입력
- **기능**: 고정 매수/매도 시간 설정
- **파라미터**:
  - `buy_time`: 매수 시간 (HH:MM 형식, 예: 09:30)
  - `sell_time`: 매도 시간 (HH:MM 형식, 예: 15:20)
- **유효성 검사**:
  - buy_time < sell_time (당일 청산)
  - 09:00 <= buy_time <= 15:30 (장 시간 범위)
  - 09:00 <= sell_time <= 16:00
- **기본값 제시**: buy_time=10:00, sell_time=15:00

#### FR-203: 전략 2 파라미터 입력
- **기능**: Trailing Stop 전략 파라미터 설정
- **파라미터**:
  - `buy_time`: 매수 시간 (기본: 15:30)
  - `min_profit_pct`: 최소 수익률(%) (기본: 1.0)
  - `profit_cutoff_pct`: 이익보전 컷오프(%) (기본: 80.0)
  - `loss_cutoff_time`: 손절 컷오프 시간 (예: 다음날 14:00)
- **유효성 검사**:
  - 0 < min_profit_pct <= 10
  - 0 < profit_cutoff_pct <= 100
  - loss_cutoff_time은 다음날 시간이어야 함

#### FR-204: 파라미터 저장
- **API 엔드포인트**: `POST /api/strategy/config`
- **요청 본문** (전략 1):
  ```json
  {
    "strategy": "daily_trading",
    "buy_time": "10:00",
    "sell_time": "15:00"
  }
  ```
- **응답**: `{ "success": true, "config_id": "cfg_001" }`

---

### 2.3 백테스팅 실행 (FR-301~FR-305)

#### FR-301: 백테스팅 시작
- **설명**: 설정된 종목 및 전략으로 백테스팅 시작
- **UI**: "백테스팅 시작" 버튼 (비활성 조건: 전략 미선택)
- **기능**:
  - 버튼 클릭 시 백엔드에 시작 신호 전송
  - 프론트엔드는 즉시 진행상황 모니터링 모드로 전환
  - 진행 상황 통신: 웹소켓 또는 Server-Sent Events (SSE) 사용
- **API 엔드포인트**: `POST /api/backtest/start`
- **요청 본문**:
  ```json
  {
    "config_id": "cfg_001",
    "blacklist": ["005930", "000660"],
    "whitelist": ["066570"]
  }
  ```
- **응답**: `{ "success": true, "session_id": "sess_abc123" }`

#### FR-302: 진행상황 실시간 모니터링
- **설명**: 웹소켓으로 백테스팅 진행 상황 실시간 전송
- **전송 간격**: 1초~5초 (또는 종목 완료 시마다)
- **메세지 형식** (JSON):
  ```json
  {
    "session_id": "sess_abc123",
    "status": "running",
    "total_symbols": 200,
    "completed_symbols": 75,
    "current_symbol": { "code": "003550", "name": "LG" },
    "elapsed_time_sec": 450,
    "eta_sec": 120
  }
  ```
- **프론트엔드 표시**:
  - "75/200 종목 완료 (37.5%)"
  - "현재 처리: LG(003550)"
  - "예상 완료: 2분 후"
  - 진행률 바 표시

#### FR-303: 백테스팅 중단
- **설명**: 진행 중인 백테스팅 중단
- **API 엔드포인트**: `POST /api/backtest/cancel/{session_id}`
- **응답**: `{ "success": true, "message": "백테스팅 중단됨" }`
- **동작**:
  - 백엔드 프로세스 즉시 종료
  - 부분 결과(이미 완료된 종목) 보존 여부: 옵션

#### FR-304: 완료 통지
- **설명**: 백테스팅 완료 시 프론트엔드에 통지
- **메세지 형식**:
  ```json
  {
    "status": "completed",
    "total_time_sec": 540,
    "total_profit": 450000,
    "profit_rate_pct": 4.5
  }
  ```

#### FR-305: 오류 처리
- **예시 오류**:
  - 네트워크 끊김: 자동 재연결 시도 (최대 3회)
  - 백엔드 오류: 사용자 친화적 에러 메세지 표시
  - 종목 데이터 부재: 해당 종목 스킵 및 로그 기록

---

### 2.4 결과 조회 (FR-401~FR-405)

#### FR-401: 결과보고서 요약 조회
- **설명**: 백테스팅 전체 결과 요약 페이지
- **표시 항목**:
  - 수익/손해 (원 단위)
  - 수익률 (%)
  - 거래 총횟수
  - 수익 거래 횟수
  - 손해 거래 횟수
  - 누적 수익액
  - 누적 손해액
  - 씨드머니 반영 여부
  - 비용 정보 (세금, 수수료)
- **시각화**: 원형 차트(거래 구성), 막대 차트(수익/손해)

#### FR-402: 결과보고서 상세조회
- **설명**: 종목별 결과 목록
- **테이블 항목**:
  - 종목코드
  - 종목명
  - 거래 횟수
  - 수익/손해 (원)
  - 수익률 (%)
- **정렬**: 수익/손해액 기준 내림차순 (기본)
- **필터**: 수익만 보기, 손해만 보기

#### FR-403: 종목별 상세 거래 내역 조회
- **설명**: 특정 종목의 모든 거래 내역 상세 조회
- **트리거**: 결과보고서의 종목 행 클릭
- **표시 항목**:
  - 거래 ID (자동 생성)
  - 거래 순번 (1번, 2번, ...)
  - 매수 날짜
  - 매수 시간
  - 매수 가격
  - 매도 날짜(보통 당일 또는 다음날)
  - 매도 시간
  - 매도 가격
  - 수익/손해 (원)
  - 수익률 (%)
  - 비용 포함 여부 (체크마크)
- **페이지네이션**: 최대 50개씩

#### FR-404: 거래 내역 차트 시각화
- **설명**: 특정 거래의 매수/매도 지점을 2분 봉 차트 위에 표시
- **트리거**: 상세 거래 내역 테이블의 특정 행 클릭
- **차트 표시**:
  - 2분 봉 캔들차트
  - 매수 지점 표기 (예: 녹색 삼각형 ↑)
  - 매도 지점 표기 (예: 빨간색 삼각형 ↓)
  - 차트 시간 범위: 해당 거래 전후 ±30봉 (약 1시간)
- **차트 라이브러리**: TradingView Lightweight Charts 또는 Chart.js

#### FR-405: 결과 다운로드
- **기능**: 결과보고서를 CSV, Excel, PDF 형식으로 다운로드
- **포함 데이터**:
  - 요약 정보
  - 종목별 상세 내역
  - 거래 내역
- **파일명 형식**: `backtest_result_20260208_cfg001.xlsx`

---

### 2.5 데이터 저장소 (FR-501~FR-502)

#### FR-501: 설정 영속성
- **저장 대상**: 블랙리스트, 화이트리스트, 전략 파라미터
- **저장 위치**: 로컬 파일 시스템 (JSON) 또는 SQLite DB
- **저장 시점**: 변경 즉시
- **파일 위치 예시**: `/data/config/blacklist.json`, `/data/config/strategy.json`
- **서버 재시작 시**: 저장된 설정 자동 로드

#### FR-502: 결과 저장
- **저장 대상**: 각 백테스팅 세션의 전체 결과
- **저장 위치**: 로컬 파일 시스템 또는 DB
- **저장 형식**: JSON 또는 SQLite
- **저장 항목**:
  - 세션 메타데이터 (시작 시간, 종료 시간, 설정 정보)
  - 종목별 결과 요약
  - 전체 거래 내역
- **보관 기간**: 최근 100개 세션 (또는 30일분)

---

## 3. 비기능 요구사항

### 3.1 성능
- **백테스팅 처리 시간**: 200개 종목, 60일치 데이터 기준 5분 이내
- **차트 로딩 시간**: 1초 이내
- **UI 반응성**: 클릭 후 0.5초 이내 응답

### 3.2 신뢰성
- **가용성**: 99% (월별)
- **오류 복구**: 네트워크 끊김 시 3회 자동 재시도
- **데이터 무결성**: 거래 내역 100% 정확도

### 3.3 보안
- **로컬 배포**: 외부 네트워크 접근 차단 (localhost만 허용)
- **HTTPS**: 필수 아님 (로컬)

### 3.4 호환성
- **브라우저**: Chrome, Firefox, Safari (최신 2개 버전)
- **해상도**: 1280×720 이상 권장

---

## 4. 요구사항 추적성 매트릭스

| 요구사항 | 유저스토리 | 우선순위 | 상태 |
|---------|----------|---------|------|
| FR-101~FR-105 | US-001, US-002 | 높음 | 정의됨 |
| FR-201~FR-204 | US-003 | 높음 | 정의됨 |
| FR-301~FR-305 | US-004, US-005 | 높음 | 정의됨 |
| FR-401~FR-405 | US-006, US-007, US-008 | 높음 | 정의됨 |
| FR-501~FR-502 | US-001, US-002, US-009 | 중간 | 정의됨 |
| 세금/수수료 | US-010 | 높음 | 정의됨 |

---

## 5. 제약사항 및 환경

### 5.1 시스템 제약
- **동시 백테스팅**: 1개 세션만 실행 (메모리 절약)
- **최대 거래 내역**: 세션당 100,000건

### 5.2 환경 요구사항
- **OS**: Windows, macOS, Linux
- **Node.js** (또는 Python Flask): 버전 14.0 이상
- **웹 서버**: Express.js 또는 Flask
- **DB** (옵션): SQLite (추가 종속성 최소화)

---

## 승인 및 서명

- **작성자**: SRS 담당자
- **리뷰어**: HLD 아키텍처 담당자
- **최종 승인**: 고객 (주식투자자)

